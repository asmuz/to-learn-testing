# Глава 5. Тестирование таблиц решений

> "Я потерпел неудачу на слушании моего первого дела об убийстве, обнаружив себя единственным свидетелем, и как бы горячо я не доказывал с Джоном Лоу, что преступник был прямо перед ними, и та самая дама, которую они допрашивали — эта знойная, но хитрая мисс Китвинкль, которая играла скорбящую простофилю, как профессиональный пианист играет на пианино — копы только продолжали улыбаться и набивать крекеры в мой клюв.​" Крис Эско

### Введение

Таблицы решений​ являются превосходным инструментом для сбора определенных видов требований системы и для документирования внутреннего устройства системы. Они используются для записи сложных бизнес-правил, которые должна реализовывать система. Кроме того, они могут служить инструкцией по созданию проверочных тестов.
Таблицы решений являются жизненно важным инструментом в наборе персональных инструментов тестировщика. К сожалению, многие аналитики, проектировщики, программисты и тестировщики не знакомы с этой техникой.

### Методика

Таблицы решений представляют собой комплекс бизнес-правил, основанных на заданных условиях.

**Основная форма:**

![Рисунок 8: Непрерывные классы эквивалентности](https://raw.githubusercontent.com/kostyashelest/to-learn-testing/master/software-test-design/img/img_8.png)

*Основная форма таблицы решений.*

Условия от 1 до m представляют собой различные исходные условия. Действия от 1 до n - это действия, которые следует предпринять в зависимости от различных комбинаций входных условий. Каждое из этих правил определяет уникальное сочетание условий, которые приводят в исполнение ("запуск") действия, связанные с этим правилом. Обратите внимание, что действия не зависят от порядка, в котором оцениваются эти условия, а только от их значений (предполагается, что все величины доступны одновременно). Кроме того, действия зависят только от определенных условий, а не от любых предыдущих исходных условий или состояния системы.

Возможно, конкретный пример прояснит эту концепцию. Компания по автострахованию дает скидку водителям, которые состоят в браке и/или хорошо учатся. Давайте начнем с у словий​ . Следующая таблица решений имеет два условия, каждое из которых может принимать значение "Да" или "Нет".

| Условия | Правило 1 | Правило 2 | Правило 3 | Правило 4 |
| --- | --- | --- | --- | --- |
| Состоит в браке? | Да | Да | Нет | Нет |
| Хороший студент? | Да | Нет | Да | Нет |

*Таблица решений с двумя бинарными условиями.*

Обратите внимание, что эта таблица содержит все комбинации условий. Задав два бинарных условия ("да" или "нет"), возможные комбинации будут: ("да", "да"), ("да", "нет"), ("нет", "да") и ("нет", "нет"). Каждое правило представляет собой одну из этих комбинаций. Нам, тестировщикам, нужно будет проверить, что определяются все комбинации условий. Пропущенное сочетание может привести к разработке такой системы, которая не сможет правильно обработать определенный набор исходных данных.
Теперь про ​ действия​ . Каждое правило является причиной "запуска" действия. Каждое правило может задать действие, уникальное для этого правила, или правила могут иметь общие действия.

| Условия | Правило 1 | Правило 2 | Правило 3 | Правило 4 |
| --- | --- | --- | --- | --- |
| Состоит в браке? | Да | Да | Нет | Нет |
| Хороший студент? | Да | Нет | Да | Нет |

| Действия |  |  |  |  |
| --- | --- | --- | --- | --- |
| Скидка ($) | 60 | 25 | 50 | 0 |

*Добавление единственного действия в таблицу решений.*

Для каждого правила с помощью таблицы решений можно указать более одного действия. Опять же, эти правила могут быть уникальными или быть общими.

| Условия | Правило 1 | Правило 2 | Правило 3 | Правило 4 |
| --- | --- | --- | --- | --- |
| Условие-1 | Да | Да | Нет | Нет |
| Условие-2 | Да | Нет | Да | Нет |

| Действия |  |  |  |  |
| --- | --- | --- | --- | --- |
| Действие-1 | Выполнить X | Выполнить Y | Выполнить X | Выполнить Z |
| Действие-2 | Выполнить А | Выполнить B | Выполнить B | Выполнить B |

*Таблица решений с несколькими действиями.*

В такой ситуации выбрать тесты просто - каждое правило (вертикальная колонка) становится тест-кейсом. Условия указывают на входные значения, а действия - на ожидаемые результаты. В предыдущих примерах используются простые бинарные условия, но условия могут быть более сложными.

| Условия | Правило 1 | Правило 2 | Правило 3 | Правило 4 |
| --- | --- | --- | --- | --- |
| Условие-1 | 0-1 | 1-10 | 10-100 | 100-1000 |
| Условие-2 | <5 | 5 | 6 или 7 | >7 |

| Действия |  |  |  |  |
| --- | --- | --- | --- | --- |
| Действие-1 | Выполнить X | Выполнить Y | Выполнить X | Выполнить Z |
| Действие-2 | Выполнить А | Выполнить B | Выполнить B | Выполнить B |

*Таблица решений со сложными условиями.*

В этой ситуации выбор тестов становится чуть более сложным - каждое правило (вертикальная колонка) становится тест-кейсом, но при этом должны быть выбраны значения, удовлетворяющие условиям. Выбирая необходимые значения, мы создаем следующие тест-кейсы:

| ID тест-кейса | Условие 1 | Условие 2 | Ожидаемый результат |
| --- | --- | --- | --- |
| Тест-кейс 1 | 0 | 3 | Выполнить X / Выполнить А |
| Тест-кейс 2 | 5 | 5 | Выполнить Y / Выполнить В |
| Тест-кейс 3 | 5 | 7 | Выполнить X / Выполнить B |
| Тест-кейс 4 | 500 | 10 | Выполнить Z / Выполнить B |

*Примерные тест-кейсы.*

Если тестируемая система имеет сложные бизнес-правила, а у ваших бизнес-аналитиков или проектировщиков нет документации этих правил, то тестировщикам следует собрать эту информацию и представить её в виде таблицы решений. Причина проста: представляя поведение системы в такой полной и компактной форме, тест-кейсы могут быть созданы непосредственно из таблицы решений.

При тестировании для каждого правила создаётся как минимум один тест-кейс. Если состояния этого правила бинарные, то должно быть достаточно одного теста для каждого сочетания. С другой стороны, если состояние является диапазоном значений, то тестирование должно учитывать и нижнюю, и высшую границы диапазона. Таким образом мы объединяем идею тестирования граничных значений с тестированием таблиц решений.

**Ключевой момент**

Для каждого правила создаётся как минимум один тест-кейс.
Чтобы создать тестовую таблицу, просто измените заголовки строк и столбцов:

| Входные значения | Тест-кейс 1 | Тест-кейс 2 | Тест-кейс 3 | Тест-кейс 4 |
| --- | --- | --- | --- | --- |
| Условие-1 | Да | Да | Нет | Нет |
| Условие-2 | Да | Нет | Да | Нет |

| Ожидаемые результаты |  |  |  |  |
| --- | --- | --- | --- | --- |
| Действие-1 | Выполнить X | Выполнить Y | Выполнить X | Выполнить Z |
| Действие-2 | Выполнить А | Выполнить B | Выполнить B | Выполнить B |

*Таблица принятия решений преобразуется в таблицу тест-кейсов.*

### Примеры

Тестирование таблиц решений может использоваться всякий раз, когда система должна реализовывать сложные бизнес-правила. Рассмотрим следующие два примера:

**Пример 1**

Ссылаясь на веб-страницу заказов веб-сайта "Браун и Дональдсон", описанного в Приложении А, рассмотрим правила, связанные с заказом покупки.

| Условия | Правило 1 | Правило 2 | Правило 3 | Правило 4 | Правило 5 | Правило 6 | Правило 7 | Правило 8 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Верный идентификатор? | Нет | Нет | Нет | Нет | Да | Да | Да | Да |
| Верное количество? | Нет | Нет | Да | Да | Нет | Нет | Да | Да |
| Достаточно средств? | Нет | Да | Нет | Да | Нет | Да | Нет | Да |

| Действия |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Можно купить? | Нет | Нет | Нет | Нет | Нет | Нет | Нет | Да |

*Таблица решений для заказа на покупку на сайте "Браун и Дональдсон"*

Конечно, результат очевиден. Заказ на покупку можно разместить только тогда, когда доступны выбранный идентификатор, количество и на счету достаточно денежных средств. Данный пример был выбран для иллюстрации другой концепции.

Исследуйте первые четыре столбца. Если идентификатор не допустимый, то остальные условия не важны. Часто таблицы, подобные этой, схлопываются, правила объединяются, а условия, которые не влияют на исход, помечаются меткой "НВ" как "не важные". Правило 1 теперь указывает, что если идентификатор не является допустимым, то нужно игнорировать другие условия и не выполнять заказ на покупку:

| Условия | Правило 1 | Правило 2 | Правило 3 | Правило 4 | Правило 5 |
| --- | --- | --- | --- | --- | --- |
| Верный идентификатор? | Нет | Да | Да | Да | Да |
| Верное количество? | НВ | Нет | Нет | Да | Да |
| Достаточно средств? | НВ | Нет | Да | Нет | Да |

| Действия |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- |
| Можно купить? | Нет | Нет | Нет | Нет | Да |

*Схлопнутая таблица решений, исключающая "не важные" условия.*

Отметим также, что правило 2 и правило 3 могут быть объединены, потому что наличие достаточных денежных средств не влияет на действие.

| Условия | Правило 1 | Правило 2 | Правило 3 | Правило 4 |
| --- | --- | --- | --- | --- |
| Верный идентификатор? | Нет | Да | Да | Да |
| Верное количество? | НВ | Нет | Да | Да |
| Достаточно средств? | НВ | НВ | Нет | Да |

| Действия |  |  |  |  |
| --- | --- | --- | --- | --- |
| Можно купить? | Нет | Нет | Нет | Да |

*Еще более схлопнутая таблица решений, исключающая "не важные" условия.*

Несмотря на то, что это отличная идея с точки зрения разработки, потому что можно будет написать меньше кода, это опасно с точки зрения тестирования. Всегда есть возможность, что таблица схлопнулась неправильно или неверно был написан код. В качестве основы для проектирования тест-кейсов всегда следует использовать несхлопнутую таблицу.

**Пример 2**

Следующее изображение взято из Регистрационной системы Государственного университета. Она используется для добавления в систему новых студентов, для изменения информации о студенте и для удаления студентов из системы.

![Рисунок 9: Непрерывные классы эквивалентности](https://raw.githubusercontent.com/kostyashelest/to-learn-testing/master/software-test-design/img/img_9.png)

*Изображение системы.*

Для добавления нового студента введите имя, адрес и телефонную информацию в верхней части экрана и нажмите Enter. Студент будет добавлен в базу данных и система вернет новый СтудентID. Чтобы изменить или удалить студента, введите СтудентID, выберите радио-кнопку "Удалить" или "Изменить" и нажмите Enter. Таблица решений отражает эти правила следующим образом:

| Условия | Правило 1 | Правило 2 | Правило 3 | Правило 4 | Правило 5 | Правило 6 | Правило 7 | Правило 8 | Правило 9 | Правило 10 | Правило 11 | Правило 12 | Правило 13 | Правило 14 | Правило 15 | Правило 16 |   
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Данные студента введены? | Нет | Нет | Нет | Нет | Нет | Нет | Нет | Нет | Да | Да | Да | Да | Да | Да | Да | Да |
| Введен студент ID? | Нет | Нет | Нет | Нет | Да | Да | Да | Да | Нет | Нет | Нет | Нет | Да | Да | Да | Да |
| Выбрано изменение? | Нет | Нет | Да | Да | Нет | Нет | Да | Да | Нет | Нет | Да | Да | Нет | Нет | Да | Да |
| Выбрано удаление? | Нет | Да | Нет | Да | Нет | Да | Нет | Да | Нет | Да | Нет | Да | Нет | Да | Нет | Да |

| Действия |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Добавление нового студента | Нет | Нет | Нет | Нет | Нет | Нет | Нет | Нет | Да | Нет | Нет | Нет | Нет | Нет | Нет | Нет |
| Изменение студента | Нет | Нет | Нет | Нет | Нет | Нет | Да | Нет | Нет | Нет | Да | Нет | Нет | Нет | Нет | Нет |
| Удаление студента | Нет | Нет | Нет | Нет | Нет | Да | Нет | Нет | Да | Нет | Нет | Нет | Нет | Нет | Нет | Нет |

*Таблица решений для Регистрационной системы Государственного университета.*

Правила с 1 по 8 показывают, что никакие данные о студенте введены не были. Правила с 1 по 4 показывают, что в случае, если для студента не был введен СтудентID, то никакие действия не возможны. Правила с 5 по 8 показывают, что СтудентID был введен. В этих случаях создание нового студента не является правильным. Правило 5 не требует ни изменения, ни удаления, поэтому не выполняется. Правила 6 и 7 требуют одну функцию и поэтому они выполняются. Обратите внимание, что правило 8 показывает, что выбраны как изменение, так и удаление, поэтому никаких действий не предпринимается.

Правила с 9 по 16 показывают, что данные о студенте были введены. Правила с 9 по 12 показывают, что СтудентID не был введен, так что эти правила относятся к созданию нового студента. Правило 9 создает нового студента. Правило 10 удаляет студента. Правило 11 позволяет изменять данные студента. Правило 12 требует, чтобы было выполнено и изменение, и удаление, поэтому никаких действий не предпринимается. Правила с 13 по 16 предоставляют данные студента, указывающие на нового студента, но в то же время предоставляют и СтудентID, указывающий на существующего студента. Из-за таких противоречивых входных данных никаких действий не предпринимается. Часто в таких ситуациях отображаются сообщения об ошибке.

### Применение и ограничения

Тестирование таблиц принятия решений может быть использовано, когда система должна реализовывать сложные бизнес-правила, когда эти правила могут быть представлены в виде комбинации условий и когда эти условия имеют дискретные действия, связанные с ними.

### Резюме

  - Таблицы решений используются для записи сложных бизнес-правил, которые должна реализовывать система. Кроме того, они могут служить инструкцией по созданию проверочных тестов.
  - Условия представляют собой различные исходные условия. Действиями являются процессы, которые должны быть выполнены в зависимости от различных комбинаций входных условий. Каждое правило определяет уникальное сочетание условий, которые приводят в исполнение ("запуск") действия, связанные с этим правилом.
  - Для каждого правила создаётся как минимум один тест-кейс. Если состояния этого правила бинарные, то должно быть достаточно одного теста для каждого сочетания. С другой стороны, если состояние является диапазоном значений, то тестирование должно учитывать и нижнюю, и высшую границы диапазона.

### Практика

Посещение Государственного университета является дорогостоящим мероприятием. В конце концов, они не получают государственное финансирование. Как и многие другие студенты, те, кто планирует его посещать, обращаются за студенческой помощью, используя БПФПС (Бесплатное Приложение для Федеральной Помощи Студентам). Следующие инструкции были взяты из этой формы. Изучите их и создайте таблицу принятия решений, представляющую правила БПФПС (примечание: вы можете не осилить материал, подобно этому).

Шаг четвертый:​ кого рассматривать в качестве родителя на этом шаге?
Прочитайте эти примечания, чтобы определить, кого нужно рассматривать в качестве родителя при заполнении этой формы. Ответьте на все вопросы четвертого шага про них, даже если вы не живете с ними.

Вы сирота, находитесь или находились (до 18 лет) под опекой? Если да, то пропустите четвертый шаг. Если ваши родители живут вместе и женаты друг на друге, ответьте на вопросы про них. Если один из ваших родителей вдовец или живет один, ответьте на вопросы только об этом родителе.

Если ваш овдовевший родитель снова женился и женат до сих пор, ответьте на вопросы об этом родителе и о человеке, на котором женат (замужем) ваш родитель. Если ваши родители разведены или живут раздельно, ответьте на вопросы о том родителе, с которым вы прожили больше за последние 12 месяцев. Если вы не жили с одним из родителей больше чем с другим, ответьте про того родителя, кто оказывал вам большую финансовую поддержку за последние 12 месяцев или в течение последнего года, когда вы получали такую поддержку от одного из родителей. Если этот родитель женился (вышел замуж) на данный момент, ответьте на оставшиеся вопросы этой формы об этом родителе и том человеке, на котором он женат (замужем).

**Литература**

Beizer, Boris ​ (1990). ​ Software Testing Techniques (Second Edition). Van Nostrand Reinhold.
Binder, Robert V.​ (2000). ​ Testing Object-Oriented Systems: Models, Patterns, and Tools. Addison-Wesley.
